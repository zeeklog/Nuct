<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nuct documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">nuct documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >NetDiskManageService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/netdisk/manager/manage.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#bucketManager" >bucketManager</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#config" >config</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#mac" >mac</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#changeFileHeaders" >changeFileHeaders</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkFileExist" >checkFileExist</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#copyFile" >copyFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#copyMultiFileOrDir" >copyMultiFileOrDir</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createDir" >createDir</a>
                            </li>
                            <li>
                                <a href="#createUploadToken" >createUploadToken</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteFile" >deleteFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteMultiFileOrDir" >deleteMultiFileOrDir</a>
                            </li>
                            <li>
                                <a href="#getDownloadLink" >getDownloadLink</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getFileInfo" >getFileInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getFileList" >getFileList</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#moveFile" >moveFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#moveMultiFileOrDir" >moveMultiFileOrDir</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#renameDir" >renameDir</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#renameFile" >renameFile</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(qiniuConfig: <a href="../miscellaneous/typealiases.html#IOssConfig" target="_self">IOssConfig</a>, userService: <a href="../injectables/UserService.html" target="_self">UserService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>qiniuConfig</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/typealiases.html#IOssConfig" target="_self" >IOssConfig</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="changeFileHeaders"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>changeFileHeaders</b></span>
                        <a href="#changeFileHeaders"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>changeFileHeaders(name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, path: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, headers: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="209"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:209</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>修改文件MimeType</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>path</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>headers</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkFileExist"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>checkFileExist</b></span>
                        <a href="#checkFileExist"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkFileExist(filePath: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="277"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:277</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>检查文件是否存在，同可检查目录</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filePath</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="copyFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>copyFile</b></span>
                        <a href="#copyFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>copyFile(dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toDir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="404"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:404</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>复制文件</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>toDir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="copyMultiFileOrDir"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>copyMultiFileOrDir</b></span>
                        <a href="#copyMultiFileOrDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>copyMultiFileOrDir(fileList: <a href="../classes/FileOpItem.html" target="_self">FileOpItem[]</a>, dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toDir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="676"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:676</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>复制文件，含文件夹</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>fileList</td>
                                            <td>
                                                            <code><a href="../classes/FileOpItem.html" target="_self" >FileOpItem[]</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>toDir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createDir"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>createDir</b></span>
                        <a href="#createDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createDir(dirName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="243"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:243</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>创建文件夹</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dirName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>true创建成功</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createUploadToken"></a>
                    <span class="name">
                        <span ><b>createUploadToken</b></span>
                        <a href="#createUploadToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createUploadToken(endUser: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="314"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:314</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>创建Upload Token, 默认过期时间一小时</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>endUser</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                <p>upload token</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>deleteFile</b></span>
                        <a href="#deleteFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteFile(dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="542"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:542</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>删除文件</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>删除的文件夹目录</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>文件名</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteMultiFileOrDir"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>deleteMultiFileOrDir</b></span>
                        <a href="#deleteMultiFileOrDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteMultiFileOrDir(fileList: <a href="../classes/FileOpItem.html" target="_self">FileOpItem[]</a>, dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="572"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:572</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>删除文件夹</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>fileList</td>
                                            <td>
                                                            <code><a href="../classes/FileOpItem.html" target="_self" >FileOpItem[]</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>需要操作的文件或文件夹</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>文件目录名称</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getDownloadLink"></a>
                    <span class="name">
                        <span ><b>getDownloadLink</b></span>
                        <a href="#getDownloadLink"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getDownloadLink(key: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="523"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:523</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>获取七牛下载的文件url链接</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>key</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>文件路径</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                <p>连接</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFileInfo"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getFileInfo</b></span>
                        <a href="#getFileInfo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFileInfo(name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, path: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="156"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:156</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>获取文件信息</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>path</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;SFileInfoDetail&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFileList"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getFileList</b></span>
                        <a href="#getFileList"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFileList(prefix: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, marker: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, skey: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="46"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:46</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>获取文件列表</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>prefix</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;&#x27;</code>
                                            </td>

                                            <td>
                                                    <p>当前文件夹路径，搜索模式下会被忽略</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>marker</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;&#x27;</code>
                                            </td>

                                            <td>
                                                    <p>下一页标识</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>skey</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>&#x27;&#x27;</code>
                                            </td>

                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../classes/SFileList.html" target="_self" >Promise&lt;SFileList&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>iFileListResult</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="moveFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>moveFile</b></span>
                        <a href="#moveFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>moveFile(dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toDir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="367"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:367</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>移动文件</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>toDir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="moveMultiFileOrDir"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>moveMultiFileOrDir</b></span>
                        <a href="#moveMultiFileOrDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>moveMultiFileOrDir(fileList: <a href="../classes/FileOpItem.html" target="_self">FileOpItem[]</a>, dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toDir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="802"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:802</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>移动文件，含文件夹</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>fileList</td>
                                            <td>
                                                            <code><a href="../classes/FileOpItem.html" target="_self" >FileOpItem[]</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>toDir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="renameDir"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>renameDir</b></span>
                        <a href="#renameDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>renameDir(path: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="444"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:444</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>重命名文件夹</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>path</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>toName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="renameFile"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>renameFile</b></span>
                        <a href="#renameFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>renameFile(dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, name: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, toName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="330"
                                    class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:330</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>重命名文件</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dir</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>文件路径</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>文件名称</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>toName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="bucketManager"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>bucketManager</b></span>
                        <a href="#bucketManager"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>rs.BucketManager</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:23</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="config"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>config</b></span>
                        <a href="#config"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>conf.Config</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="mac"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>mac</b></span>
                        <a href="#mac"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>auth.digest.Mac</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/modules/netdisk/manager/manage.service.ts:22</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { basename, extname } from &#x27;node:path&#x27;

import { Inject, Injectable } from &#x27;@nestjs/common&#x27;
import { isEmpty } from &#x27;lodash&#x27;
import * as qiniu from &#x27;qiniu&#x27;
import { auth, conf, rs } from &#x27;qiniu&#x27;

import { IOssConfig, OssConfig } from &#x27;~/config&#x27;
import { NETDISK_COPY_SUFFIX, NETDISK_DELIMITER, NETDISK_HANDLE_MAX_ITEM, NETDISK_LIMIT } from &#x27;~/constants/oss.constant&#x27;

import { AccountInfo } from &#x27;~/modules/user/user.model&#x27;
import { UserService } from &#x27;~/modules/user/user.service&#x27;

import { generateRandomValue } from &#x27;~/utils&#x27;

import { SFileInfo, SFileInfoDetail, SFileList } from &#x27;./manage.class&#x27;
import { FileOpItem } from &#x27;./manage.dto&#x27;

@Injectable()
export class NetDiskManageService {
  private config: conf.Config
  private mac: auth.digest.Mac
  private bucketManager: rs.BucketManager

  constructor(
    @Inject(OssConfig.KEY) private qiniuConfig: IOssConfig,
    private userService: UserService,
  ) {
    this.mac &#x3D; new qiniu.auth.digest.Mac(
      this.qiniuConfig.accessKey,
      this.qiniuConfig.secretKey,
    )
    this.config &#x3D; new qiniu.conf.Config({
      zone: this.qiniuConfig.zone,
    })
    // bucket manager
    this.bucketManager &#x3D; new qiniu.rs.BucketManager(this.mac, this.config)
  }

  /**
   * 获取文件列表
   * @param prefix 当前文件夹路径，搜索模式下会被忽略
   * @param marker 下一页标识
   * @returns iFileListResult
   */
  async getFileList(prefix &#x3D; &#x27;&#x27;, marker &#x3D; &#x27;&#x27;, skey &#x3D; &#x27;&#x27;): Promise&lt;SFileList&gt; {
    // 是否需要搜索
    const searching &#x3D; !isEmpty(skey)
    return new Promise&lt;SFileList&gt;((resolve, reject) &#x3D;&gt; {
      this.bucketManager.listPrefix(
        this.qiniuConfig.bucket,
        {
          prefix: searching ? &#x27;&#x27; : prefix,
          limit: NETDISK_LIMIT,
          delimiter: searching ? &#x27;&#x27; : NETDISK_DELIMITER,
          marker,
        },
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            // 如果这个nextMarker不为空，那么还有未列举完毕的文件列表，下次调用listPrefix的时候，
            // 指定options里面的marker为这个值
            const fileList: SFileInfo[] &#x3D; []
            // 处理目录，但只有非搜索模式下可用
            if (!searching &amp;&amp; !isEmpty(respBody.commonPrefixes)) {
              // dir
              for (const dirPath of respBody.commonPrefixes) {
                const name &#x3D; (dirPath as string)
                  .substr(0, dirPath.length - 1)
                  .replace(prefix, &#x27;&#x27;)
                if (isEmpty(skey) || name.includes(skey)) {
                  fileList.push({
                    name: (dirPath as string)
                      .substr(0, dirPath.length - 1)
                      .replace(prefix, &#x27;&#x27;),
                    type: &#x27;dir&#x27;,
                    id: generateRandomValue(10),
                  })
                }
              }
            }
            // handle items
            if (!isEmpty(respBody.items)) {
              // file
              for (const item of respBody.items) {
                // 搜索模式下处理
                if (searching) {
                  const pathList: string[] &#x3D; item.key.split(NETDISK_DELIMITER)
                  // dir is empty stirng, file is key string
                  const name &#x3D; pathList.pop()
                  if (
                    item.key.endsWith(NETDISK_DELIMITER)
                    &amp;&amp; pathList[pathList.length - 1].includes(skey)
                  ) {
                    // 结果是目录
                    const ditName &#x3D; pathList.pop()
                    fileList.push({
                      id: generateRandomValue(10),
                      name: ditName,
                      type: &#x27;dir&#x27;,
                      belongTo: pathList.join(NETDISK_DELIMITER),
                    })
                  }
                  else if (name.includes(skey)) {
                    // 文件
                    fileList.push({
                      id: generateRandomValue(10),
                      name,
                      type: &#x27;file&#x27;,
                      fsize: item.fsize,
                      mimeType: item.mimeType,
                      putTime: new Date(Number.parseInt(item.putTime) / 10000),
                      belongTo: pathList.join(NETDISK_DELIMITER),
                    })
                  }
                }
                else {
                  // 正常获取列表
                  const fileKey &#x3D; item.key.replace(prefix, &#x27;&#x27;) as string
                  if (!isEmpty(fileKey)) {
                    fileList.push({
                      id: generateRandomValue(10),
                      name: fileKey,
                      type: &#x27;file&#x27;,
                      fsize: item.fsize,
                      mimeType: item.mimeType,
                      putTime: new Date(Number.parseInt(item.putTime) / 10000),
                    })
                  }
                }
              }
            }
            resolve({
              list: fileList,
              marker: respBody.marker || null,
            })
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 获取文件信息
   */
  async getFileInfo(name: string, path: string): Promise&lt;SFileInfoDetail&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.stat(
        this.qiniuConfig.bucket,
        &#x60;${path}${name}&#x60;,
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            const detailInfo: SFileInfoDetail &#x3D; {
              fsize: respBody.fsize,
              hash: respBody.hash,
              md5: respBody.md5,
              mimeType: respBody.mimeType.split(&#x27;/x-qn-meta&#x27;)[0],
              putTime: new Date(Number.parseInt(respBody.putTime) / 10000),
              type: respBody.type,
              uploader: &#x27;&#x27;,
              mark: respBody?.[&#x27;x-qn-meta&#x27;]?.[&#x27;!mark&#x27;] ?? &#x27;&#x27;,
            }
            if (!respBody.endUser) {
              resolve(detailInfo)
            }
            else {
              this.userService
                .getAccountInfo(Number.parseInt(respBody.endUser))
                .then((user: AccountInfo) &#x3D;&gt; {
                  if (isEmpty(user)) {
                    resolve(detailInfo)
                  }
                  else {
                    detailInfo.uploader &#x3D; user.username
                    resolve(detailInfo)
                  }
                })
            }
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 修改文件MimeType
   */
  async changeFileHeaders(
    name: string,
    path: string,
    headers: { [k: string]: string },
  ): Promise&lt;void&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.changeHeaders(
        this.qiniuConfig.bucket,
        &#x60;${path}${name}&#x60;,
        headers,
        (err, _, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 创建文件夹
   * @returns true创建成功
   */
  async createDir(dirName: string): Promise&lt;void&gt; {
    const safeDirName &#x3D; dirName.endsWith(&#x27;/&#x27;) ? dirName : &#x60;${dirName}/&#x60;
    return new Promise((resolve, reject) &#x3D;&gt; {
      // 上传一个空文件以用于显示文件夹效果
      const formUploader &#x3D; new qiniu.form_up.FormUploader(this.config)
      const putExtra &#x3D; new qiniu.form_up.PutExtra()
      formUploader.put(
        this.createUploadToken(&#x27;&#x27;),
        safeDirName,
        &#x27; &#x27;,
        putExtra,
        (respErr, respBody, respInfo) &#x3D;&gt; {
          if (respErr) {
            reject(respErr)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 检查文件是否存在，同可检查目录
   */
  async checkFileExist(filePath: string): Promise&lt;boolean&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      // fix path end must a /

      // 检测文件夹是否存在
      this.bucketManager.stat(
        this.qiniuConfig.bucket,
        filePath,
        (respErr, respBody, respInfo) &#x3D;&gt; {
          if (respErr) {
            reject(respErr)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            // 文件夹存在
            resolve(true)
          }
          else if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 612) {
            // 文件夹不存在
            resolve(false)
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 创建Upload Token, 默认过期时间一小时
   * @returns upload token
   */
  createUploadToken(endUser: string): string {
    const policy &#x3D; new qiniu.rs.PutPolicy({
      scope: this.qiniuConfig.bucket,
      insertOnly: 1,
      fsizeLimit: 1024 ** 2 * 10,
      endUser,
    })
    const uploadToken &#x3D; policy.uploadToken(this.mac)
    return uploadToken
  }

  /**
   * 重命名文件
   * @param dir 文件路径
   * @param name 文件名称
   */
  async renameFile(dir: string, name: string, toName: string): Promise&lt;void&gt; {
    const fileName &#x3D; &#x60;${dir}${name}&#x60;
    const toFileName &#x3D; &#x60;${dir}${toName}&#x60;
    const op &#x3D; {
      force: true,
    }
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.move(
        this.qiniuConfig.bucket,
        fileName,
        this.qiniuConfig.bucket,
        toFileName,
        op,
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
          }
          else {
            if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
              resolve()
            }
            else {
              reject(
                new Error(
                  &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                ),
              )
            }
          }
        },
      )
    })
  }

  /**
   * 移动文件
   */
  async moveFile(dir: string, toDir: string, name: string): Promise&lt;void&gt; {
    const fileName &#x3D; &#x60;${dir}${name}&#x60;
    const toFileName &#x3D; &#x60;${toDir}${name}&#x60;
    const op &#x3D; {
      force: true,
    }
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.move(
        this.qiniuConfig.bucket,
        fileName,
        this.qiniuConfig.bucket,
        toFileName,
        op,
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
          }
          else {
            if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
              resolve()
            }
            else {
              reject(
                new Error(
                  &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                ),
              )
            }
          }
        },
      )
    })
  }

  /**
   * 复制文件
   */
  async copyFile(dir: string, toDir: string, name: string): Promise&lt;void&gt; {
    const fileName &#x3D; &#x60;${dir}${name}&#x60;
    // 拼接文件名
    const ext &#x3D; extname(name)
    const bn &#x3D; basename(name, ext)
    const toFileName &#x3D; &#x60;${toDir}${bn}${NETDISK_COPY_SUFFIX}${ext}&#x60;
    const op &#x3D; {
      force: true,
    }
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.copy(
        this.qiniuConfig.bucket,
        fileName,
        this.qiniuConfig.bucket,
        toFileName,
        op,
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
          }
          else {
            if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
              resolve()
            }
            else {
              reject(
                new Error(
                  &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                ),
              )
            }
          }
        },
      )
    })
  }

  /**
   * 重命名文件夹
   */
  async renameDir(path: string, name: string, toName: string): Promise&lt;void&gt; {
    const dirName &#x3D; &#x60;${path}${name}&#x60;
    const toDirName &#x3D; &#x60;${path}${toName}&#x60;
    let hasFile &#x3D; true
    let marker &#x3D; &#x27;&#x27;
    const op &#x3D; {
      force: true,
    }
    const bucketName &#x3D; this.qiniuConfig.bucket
    while (hasFile) {
      await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
        // 列举当前目录下的所有文件
        this.bucketManager.listPrefix(
          this.qiniuConfig.bucket,
          {
            prefix: dirName,
            limit: NETDISK_HANDLE_MAX_ITEM,
            marker,
          },
          (err, respBody, respInfo) &#x3D;&gt; {
            if (err) {
              reject(err)
              return
            }
            if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
              const moveOperations &#x3D; respBody.items.map((item) &#x3D;&gt; {
                const { key } &#x3D; item
                const destKey &#x3D; key.replace(dirName, toDirName)
                return qiniu.rs.moveOp(
                  bucketName,
                  key,
                  bucketName,
                  destKey,
                  op,
                )
              })
              this.bucketManager.batch(
                moveOperations,
                (err2, respBody2, respInfo2) &#x3D;&gt; {
                  if (err2) {
                    reject(err2)
                    return
                  }
                  if (respInfo2.statusCode &#x3D;&#x3D;&#x3D; 200) {
                    if (isEmpty(respBody.marker))
                      hasFile &#x3D; false
                    else
                      marker &#x3D; respBody.marker

                    resolve()
                  }
                  else {
                    reject(
                      new Error(
                        &#x60;Qiniu Error Code: ${respInfo2.statusCode}, Info: ${respInfo2.statusMessage}&#x60;,
                      ),
                    )
                  }
                },
              )
            }
            else {
              reject(
                new Error(
                  &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                ),
              )
            }
          },
        )
      })
    }
  }

  /**
   * 获取七牛下载的文件url链接
   * @param key 文件路径
   * @returns 连接
   */
  getDownloadLink(key: string): string {
    if (this.qiniuConfig.access &#x3D;&#x3D;&#x3D; &#x27;public&#x27;) {
      return this.bucketManager.publicDownloadUrl(this.qiniuConfig.domain, key)
    }
    else if (this.qiniuConfig.access &#x3D;&#x3D;&#x3D; &#x27;private&#x27;) {
      return this.bucketManager.privateDownloadUrl(
        this.qiniuConfig.domain,
        key,
        Date.now() / 1000 + 36000,
      )
    }
    throw new Error(&#x27;qiniu config access type not support&#x27;)
  }

  /**
   * 删除文件
   * @param dir 删除的文件夹目录
   * @param name 文件名
   */
  async deleteFile(dir: string, name: string): Promise&lt;void&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.bucketManager.delete(
        this.qiniuConfig.bucket,
        &#x60;${dir}${name}&#x60;,
        (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        },
      )
    })
  }

  /**
   * 删除文件夹
   * @param fileList 需要操作的文件或文件夹
   * @param dir 文件目录名称
   */
  async deleteMultiFileOrDir(
    fileList: FileOpItem[],
    dir: string,
  ): Promise&lt;void&gt; {
    const files &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;file&#x27;)
    if (files.length &gt; 0) {
      // 批处理文件
      const copyOperations &#x3D; files.map((item) &#x3D;&gt; {
        const fileName &#x3D; &#x60;${dir}${item.name}&#x60;
        return qiniu.rs.deleteOp(this.qiniuConfig.bucket, fileName)
      })
      await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
        this.bucketManager.batch(copyOperations, (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 298) {
            reject(new Error(&#x27;操作异常，但部分文件夹删除成功&#x27;))
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        })
      })
    }
    // 处理文件夹
    const dirs &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;dir&#x27;)
    if (dirs.length &gt; 0) {
      // 处理文件夹的复制
      for (let i &#x3D; 0; i &lt; dirs.length; i++) {
        const dirName &#x3D; &#x60;${dir}${dirs[i].name}/&#x60;
        let hasFile &#x3D; true
        let marker &#x3D; &#x27;&#x27;
        while (hasFile) {
          await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
            // 列举当前目录下的所有文件
            this.bucketManager.listPrefix(
              this.qiniuConfig.bucket,
              {
                prefix: dirName,
                limit: NETDISK_HANDLE_MAX_ITEM,
                marker,
              },
              (err, respBody, respInfo) &#x3D;&gt; {
                if (err) {
                  reject(err)
                  return
                }
                if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
                  const moveOperations &#x3D; respBody.items.map((item) &#x3D;&gt; {
                    const { key } &#x3D; item
                    return qiniu.rs.deleteOp(this.qiniuConfig.bucket, key)
                  })
                  this.bucketManager.batch(
                    moveOperations,
                    (err2, respBody2, respInfo2) &#x3D;&gt; {
                      if (err2) {
                        reject(err2)
                        return
                      }
                      if (respInfo2.statusCode &#x3D;&#x3D;&#x3D; 200) {
                        if (isEmpty(respBody.marker))
                          hasFile &#x3D; false
                        else
                          marker &#x3D; respBody.marker

                        resolve()
                      }
                      else {
                        reject(
                          new Error(
                            &#x60;Qiniu Error Code: ${respInfo2.statusCode}, Info: ${respInfo2.statusMessage}&#x60;,
                          ),
                        )
                      }
                    },
                  )
                }
                else {
                  reject(
                    new Error(
                      &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                    ),
                  )
                }
              },
            )
          })
        }
      }
    }
  }

  /**
   * 复制文件，含文件夹
   */
  async copyMultiFileOrDir(
    fileList: FileOpItem[],
    dir: string,
    toDir: string,
  ): Promise&lt;void&gt; {
    const files &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;file&#x27;)
    const op &#x3D; {
      force: true,
    }
    if (files.length &gt; 0) {
      // 批处理文件
      const copyOperations &#x3D; files.map((item) &#x3D;&gt; {
        const fileName &#x3D; &#x60;${dir}${item.name}&#x60;
        // 拼接文件名
        const ext &#x3D; extname(item.name)
        const bn &#x3D; basename(item.name, ext)
        const toFileName &#x3D; &#x60;${toDir}${bn}${NETDISK_COPY_SUFFIX}${ext}&#x60;
        return qiniu.rs.copyOp(
          this.qiniuConfig.bucket,
          fileName,
          this.qiniuConfig.bucket,
          toFileName,
          op,
        )
      })
      await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
        this.bucketManager.batch(copyOperations, (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 298) {
            reject(new Error(&#x27;操作异常，但部分文件夹删除成功&#x27;))
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        })
      })
    }
    // 处理文件夹
    const dirs &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;dir&#x27;)
    if (dirs.length &gt; 0) {
      // 处理文件夹的复制
      for (let i &#x3D; 0; i &lt; dirs.length; i++) {
        const dirName &#x3D; &#x60;${dir}${dirs[i].name}/&#x60;
        const copyDirName &#x3D; &#x60;${toDir}${dirs[i].name}${NETDISK_COPY_SUFFIX}/&#x60;
        let hasFile &#x3D; true
        let marker &#x3D; &#x27;&#x27;
        while (hasFile) {
          await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
            // 列举当前目录下的所有文件
            this.bucketManager.listPrefix(
              this.qiniuConfig.bucket,
              {
                prefix: dirName,
                limit: NETDISK_HANDLE_MAX_ITEM,
                marker,
              },
              (err, respBody, respInfo) &#x3D;&gt; {
                if (err) {
                  reject(err)
                  return
                }
                if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
                  const moveOperations &#x3D; respBody.items.map((item) &#x3D;&gt; {
                    const { key } &#x3D; item
                    const destKey &#x3D; key.replace(dirName, copyDirName)
                    return qiniu.rs.copyOp(
                      this.qiniuConfig.bucket,
                      key,
                      this.qiniuConfig.bucket,
                      destKey,
                      op,
                    )
                  })
                  this.bucketManager.batch(
                    moveOperations,
                    (err2, respBody2, respInfo2) &#x3D;&gt; {
                      if (err2) {
                        reject(err2)
                        return
                      }
                      if (respInfo2.statusCode &#x3D;&#x3D;&#x3D; 200) {
                        if (isEmpty(respBody.marker))
                          hasFile &#x3D; false
                        else
                          marker &#x3D; respBody.marker

                        resolve()
                      }
                      else {
                        reject(
                          new Error(
                            &#x60;Qiniu Error Code: ${respInfo2.statusCode}, Info: ${respInfo2.statusMessage}&#x60;,
                          ),
                        )
                      }
                    },
                  )
                }
                else {
                  reject(
                    new Error(
                      &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                    ),
                  )
                }
              },
            )
          })
        }
      }
    }
  }

  /**
   * 移动文件，含文件夹
   */
  async moveMultiFileOrDir(
    fileList: FileOpItem[],
    dir: string,
    toDir: string,
  ): Promise&lt;void&gt; {
    const files &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;file&#x27;)
    const op &#x3D; {
      force: true,
    }
    if (files.length &gt; 0) {
      // 批处理文件
      const copyOperations &#x3D; files.map((item) &#x3D;&gt; {
        const fileName &#x3D; &#x60;${dir}${item.name}&#x60;
        const toFileName &#x3D; &#x60;${toDir}${item.name}&#x60;
        return qiniu.rs.moveOp(
          this.qiniuConfig.bucket,
          fileName,
          this.qiniuConfig.bucket,
          toFileName,
          op,
        )
      })
      await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
        this.bucketManager.batch(copyOperations, (err, respBody, respInfo) &#x3D;&gt; {
          if (err) {
            reject(err)
            return
          }
          if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
            resolve()
          }
          else if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 298) {
            reject(new Error(&#x27;操作异常，但部分文件夹删除成功&#x27;))
          }
          else {
            reject(
              new Error(
                &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
              ),
            )
          }
        })
      })
    }
    // 处理文件夹
    const dirs &#x3D; fileList.filter(item &#x3D;&gt; item.type &#x3D;&#x3D;&#x3D; &#x27;dir&#x27;)
    if (dirs.length &gt; 0) {
      // 处理文件夹的复制
      for (let i &#x3D; 0; i &lt; dirs.length; i++) {
        const dirName &#x3D; &#x60;${dir}${dirs[i].name}/&#x60;
        const toDirName &#x3D; &#x60;${toDir}${dirs[i].name}/&#x60;
        // 移动的目录不是是自己
        if (toDirName.startsWith(dirName))
          continue

        let hasFile &#x3D; true
        let marker &#x3D; &#x27;&#x27;
        while (hasFile) {
          await new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
            // 列举当前目录下的所有文件
            this.bucketManager.listPrefix(
              this.qiniuConfig.bucket,
              {
                prefix: dirName,
                limit: NETDISK_HANDLE_MAX_ITEM,
                marker,
              },
              (err, respBody, respInfo) &#x3D;&gt; {
                if (err) {
                  reject(err)
                  return
                }
                if (respInfo.statusCode &#x3D;&#x3D;&#x3D; 200) {
                  const moveOperations &#x3D; respBody.items.map((item) &#x3D;&gt; {
                    const { key } &#x3D; item
                    const destKey &#x3D; key.replace(dirName, toDirName)
                    return qiniu.rs.moveOp(
                      this.qiniuConfig.bucket,
                      key,
                      this.qiniuConfig.bucket,
                      destKey,
                      op,
                    )
                  })
                  this.bucketManager.batch(
                    moveOperations,
                    (err2, respBody2, respInfo2) &#x3D;&gt; {
                      if (err2) {
                        reject(err2)
                        return
                      }
                      if (respInfo2.statusCode &#x3D;&#x3D;&#x3D; 200) {
                        if (isEmpty(respBody.marker))
                          hasFile &#x3D; false
                        else
                          marker &#x3D; respBody.marker

                        resolve()
                      }
                      else {
                        reject(
                          new Error(
                            &#x60;Qiniu Error Code: ${respInfo2.statusCode}, Info: ${respInfo2.statusMessage}&#x60;,
                          ),
                        )
                      }
                    },
                  )
                }
                else {
                  reject(
                    new Error(
                      &#x60;Qiniu Error Code: ${respInfo.statusCode}, Info: ${respInfo.statusMessage}&#x60;,
                    ),
                  )
                }
              },
            )
          })
        }
      }
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'NetDiskManageService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
